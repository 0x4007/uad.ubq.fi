(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[169],{7016:function(e,t,n){"use strict";n.d(t,{A:function(){return o},P:function(){return l}});var a=n(266),s=n(809),r=n.n(s),c=n(7616),i=n(2505);function o(e,t,n,a,s){return u.apply(this,arguments)}function u(){return(u=(0,a.Z)(r().mark((function e(t,n,a,s,o){var u,l,d,x,f=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=f.length>5&&void 0!==f[5]?f[5]:18,e.next=3,s.getAddress();case 3:return l=e.sent,e.next=6,n.allowance(l,o);case 6:if(d=e.sent,console.log("Current ".concat(t," allowance: ").concat(c.bM(d,u)," | Requesting: ").concat(c.bM(a,u))),!d.lt(a)){e.next=17;break}return e.next=11,(0,i.$e)(n.connect(s).approve(o,a));case 11:if(e.sent){e.next=13;break}return e.abrupt("return",!1);case 13:return e.next=15,n.allowance(l,o);case 15:x=e.sent,console.log("New ".concat(t," allowance: "),c.bM(x,u));case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e,t,n,a){return d.apply(this,arguments)}function d(){return(d=(0,a.Z)(r().mark((function e(t,n,a,s){var c,o,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getAddress();case 2:return c=e.sent,e.next=5,n.isApprovedForAll(c,s);case 5:if(o=e.sent,console.log("".concat(t," isAllowed: "),o),o){e.next=16;break}return e.next=10,(0,i.$e)(n.connect(a).setApprovalForAll(s,!0));case 10:if(e.sent){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,n.isApprovedForAll(c,s);case 14:u=e.sent,console.log("New ".concat(t," isAllowed: "),u);case 16:return e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},8118:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a=n(2809),s=n(6311),r=n(5193),c=n(7098),i=n(1582),o=n(6484),u=n(5893);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e,t){return function(n){var d=(0,o.ZP)(),x=(0,s.Z)(d,1)[0],f=x.walletAddress,m=x.signer,p=x.provider,b=(0,c.ZP)(),h=(0,r.Z)(),j=(0,i.ZP)();return p&&f&&m&&b&&h&&j?(0,u.jsx)(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({web3Provider:p,walletAddress:f,signer:m,namedContracts:j,managedContracts:b,deployedContracts:h},n)):t?(0,u.jsx)(t,{}):null}}},8258:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var a=n(266),s=n(6311),r=n(809),c=n.n(r),i=n(7294),o=n(7616),u=n(8118),l=n(7016),d=n(2505),x=n(4358),f=n(9753),m=n(2593),p="usdc",b=function(e){return+e.toString()/1e18};function h(e){return j.apply(this,arguments)}function j(){return(j=(0,a.Z)(c().mark((function e(t){var n,a,r,i,u,l,d,x,f,m,b,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.yieldProxy.bonusYield(),t.yieldProxy.BONUS_YIELD_MAX(),t.yieldProxy.fees(),t.yieldProxy.FEES_MAX(),t.yieldProxy.ubqRate(),t.yieldProxy.UBQ_RATE_MAX()]);case 2:return n=e.sent,a=(0,s.Z)(n,6),r=a[0],i=a[1],u=a[2],l=a[3],d=a[4],x=a[5],f=o.fi("100").mul(x).div(d),e.next=13,t.jarUsdc.getRatio();case 13:return m=e.sent,b=m,h={token:p,decimals:6,depositFeeMax:l,depositFeeBase:u,depositFeeBasePct:u.toNumber()/l.toNumber(),depositFeeUbqMax:f,bonusYieldMax:i,bonusYieldBase:r,bonusYieldBasePct:r.toNumber()/i.toNumber(),bonusYieldMaxPct:1,bonusYieldUadMaxPct:.5,jarRatio:b},e.abrupt("return",h);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,n){return w.apply(this,arguments)}function w(){return(w=(0,a.Z)(c().mark((function e(t,n,r){var i,o,u,l,d,x,f,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.Z)(c().mark((function e(){var t,a,i,o,u,l,d,x,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.yieldProxy.getInfo(r);case 2:return t=e.sent,a=(0,s.Z)(t,7),i=a[0],o=a[1],u=a[2],l=a[3],d=a[4],x=a[5],f=a[6],e.abrupt("return",{amount:i,shares:o,uadAmount:u,ubqAmount:l,fee:d,ratio:x,bonusYield:f});case 12:case"end":return e.stop()}}),e)})))();case 2:if(!(i=e.sent).amount.eq(0)){e.next=5;break}return e.abrupt("return",null);case 5:return o=t.decimals<18?i.amount.mul(Math.pow(10,18-t.decimals)):i.amount,u=t.decimals<18?i.fee.mul(Math.pow(10,18-t.decimals)):i.fee,l=o.mul(t.jarRatio).div(i.ratio).sub(o),d=l.gt(0)?l.mul(i.bonusYield).div(t.bonusYieldMax):m.O$.from(0),x=b(o.add(l).add(d))/b(o)-1,f=t.depositFeeBasePct-b(i.ubqAmount)/b(t.depositFeeUbqMax)*t.depositFeeBasePct,p={amount:i.amount,newAmount:i.amount.sub(i.fee),uad:i.uadAmount,ubq:i.ubqAmount,jarYieldAmount:l,bonusYieldExtraPct:b(i.bonusYield)/b(t.bonusYieldMax)-t.bonusYieldBasePct,bonusYieldTotalPct:b(i.bonusYield)/b(t.bonusYieldMax),bonusYieldAmount:d,feeAmount:u,feePct:f,uar:l.add(d).add(u),currentYieldPct:x},e.abrupt("return",p);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=n(5893),g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:18;return+o.bM(e,t)},P={min:10.1,max:19.65},N={usdc:1.2,ubq:2.5,uad:.6},A=function(e){var t=e.actions,n=e.yieldProxyData,a=e.depositInfo,s=e.isProcessing,r=e.balance;return(0,y.jsxs)(f.W2,{className:"relative !mx-auto max-w-screen-md",children:[(0,y.jsx)(f.Dx,{text:"Boosted Yield Farming (Beta)"}),(0,y.jsxs)("div",{className:"mb-4 flex items-center justify-evenly rounded-md border border-solid border-white/10 p-4",children:[(0,y.jsx)("div",{className:"w-20",children:(0,y.jsx)(f.JO,{icon:"warning",className:"w-10 text-white"})}),(0,y.jsx)("p",{className:"flex-grow text-left",children:(0,y.jsx)("span",{children:"Explainer article coming soon!"})})]}),(0,y.jsxs)("div",{className:"mb-12 flex items-center justify-evenly rounded-md border border-solid border-white/10 p-4",children:[(0,y.jsx)("div",{className:"w-20",children:(0,y.jsx)(f.JO,{icon:"warning",className:"w-10 text-white"})}),(0,y.jsxs)("p",{className:"flex-grow text-left",children:[(0,y.jsx)("span",{children:"uCR is 1:1 redeemable for uAD when the TWAP goes above 1.00. "}),(0,y.jsx)("a",{target:"_blank",className:"text-white",href:"https://medium.com/ubiquity-dao/ubiquitys-debt-system-explained-40e51325fc5",children:"Learn more \xbb"})]})]}),n?a?(0,y.jsx)(M,{token:n.token.toUpperCase(),amount:g(a.amount,n.decimals),newAmount:g(a.newAmount,n.decimals),yieldPct:a.currentYieldPct,yieldAmount:g(a.jarYieldAmount),uad:g(a.uad),uadMax:n.bonusYieldUadMaxPct*+g(a.amount,n.decimals),uadBasePct:n.bonusYieldBasePct,uadBonusPct:a.bonusYieldExtraPct,uadBonusAmount:g(a.bonusYieldAmount),ubq:g(a.ubq),ubqMax:g(n.depositFeeUbqMax),feePct:a.feePct,feePctMax:n.depositFeeBasePct,feeAmount:g(a.feeAmount),uar:g(a.uar),uarApyMin:P.min+a.bonusYieldTotalPct*P.min,uarApyMax:P.max+a.bonusYieldTotalPct*P.max,uarCurrentYieldPct:a.currentYieldPct,onWithdraw:t.onWithdraw,disable:s}):r?(0,y.jsx)(k,{tvl:N,usdcApy:P,maxUbqAmount:+o.dF(n.depositFeeUbqMax),maxUadPct:n.bonusYieldUadMaxPct,baseYieldBonusPct:n.bonusYieldBasePct,maxYieldBonusPct:n.bonusYieldMaxPct,baseDepositFeePct:n.depositFeeBasePct,minDepositFeePct:0,balance:r,onDeposit:t.onDeposit,disable:s}):"Loading...":"Loading..."]})},Y=function(e){return(Math.round(100*e)/100).toLocaleString()},M=(0,i.memo)((function(e){var t=e.token,n=e.amount,a=e.newAmount,s=e.yieldPct,r=e.yieldAmount,c=e.uad,i=e.uadMax,o=e.uadBasePct,u=e.uadBonusPct,l=e.uadBonusAmount,d=e.ubq,x=e.ubqMax,m=e.feePct,p=e.feePctMax,b=e.feeAmount,h=e.uar,j=e.uarApyMin,v=e.uarApyMax,w=e.uarCurrentYieldPct,g=e.disable,P=e.onWithdraw;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(f.DK,{text:"Current Deposit"}),(0,y.jsxs)("div",{className:"grid grid-cols-3 gap-y-4",children:[(0,y.jsx)(F,{val:Y(a),fadeVal:" (".concat(Y(n),")"),text:t}),(0,y.jsx)(F,{val:"".concat(Y(100*s),"%"),text:"Yield %"}),(0,y.jsx)(F,{val:"".concat(Y(r)," uCR"),text:"Yield"}),(0,y.jsx)(F,{val:Y(c),fadeVal:" / ".concat(Y(i)),text:"uAD"}),(0,y.jsx)(F,{val:"".concat(Y(100*o),"% + ").concat(Y(100*u),"%"),text:"Yield Multiplier"}),(0,y.jsx)(F,{val:"".concat(Y(l)," uCR"),text:"Bonus Yield"}),(0,y.jsx)(F,{val:Y(d),fadeVal:" / ".concat(Y(x)),text:"UBQ"}),(0,y.jsx)(F,{val:"".concat(Y(100*m),"%"),fadeVal:" / ".concat(Y(100*p),"%"),text:"Deposit Fee"}),(0,y.jsx)(F,{val:"".concat(Y(b)," uCR"),text:"Converted from ".concat(t)}),(0,y.jsx)(F,{val:Y(h),text:"uCR"}),(0,y.jsx)(F,{val:"".concat(Y(j),"% - ").concat(Y(v),"%"),text:"APY in uCR"}),(0,y.jsx)(F,{val:"".concat(Y(100*w),"%"),text:"Current Yield"})]}),(0,y.jsx)("div",{className:"flex justify-center pt-8",children:(0,y.jsx)(f.zx,{styled:"accent",size:"lg",onClick:P,disabled:g,children:"Withdraw"})})]})})),F=function(e){var t=e.val,n=e.fadeVal,a=e.text;return(0,y.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,y.jsxs)("div",{className:"mb-1 text-lg font-bold",children:[t,n?(0,y.jsx)("span",{className:"opacity-50",children:n}):null]}),(0,y.jsx)("div",{className:"text-sm",children:a})]})},k=(0,i.memo)((function(e){var t=e.usdcApy,n=e.maxUbqAmount,a=e.maxUadPct,s=e.baseYieldBonusPct,r=e.maxYieldBonusPct,c=e.baseDepositFeePct,o=e.minDepositFeePct,u=e.balance,l=e.disable,x=e.onDeposit,m=(0,i.useState)(""),p=m[0],b=m[1],h=(0,i.useState)(""),j=h[0],v=h[1],w=(0,i.useState)(""),g=w[0],P=w[1],N=(0,i.useState)([]),A=N[0],M=N[1],F=parseFloat(p)||0,k=parseFloat(j)||0,B=parseFloat(g)||0,C=function(){return s+(r-s)*(F?B/(a*F):0)};(0,i.useEffect)((function(){var e=[],t=function(e){return"You don't have enough ".concat(e.toUpperCase(),".")};F>u.usdc&&e.push(t("usdc")),k>u.ubq&&e.push(t("ubq")),B>u.uad&&e.push(t("uad")),M(e)}),[p,j,g]);var D=function(e){var t=e.content;return(0,y.jsx)(f.u,{content:t,children:(0,y.jsx)("span",{className:"pl-2",children:(0,y.jsx)(f.JO,{icon:"help",className:"inline w-4 text-white"})})})};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(f.DK,{text:"Primary deposit"}),(0,y.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"w-5/12",style:{backgroundImage:"url('data:image/svg+xml;utf8,".concat(f.ci.strings.usdc,"')")},children:[(0,y.jsx)("div",{className:"flex justify-between",children:(0,y.jsx)("span",{className:"font-bold",children:"USDC"})}),(0,y.jsxs)("div",{className:"mb-2 text-left",children:[(0,y.jsxs)("span",{children:[t.min.toFixed(2),"% - ",t.max.toFixed(2),"%"]}),(0,y.jsx)("span",{className:"pl-2",children:"APY"}),(0,y.jsx)(D,{content:"This is the APY from the Pickle Finance USDC jar"})]}),(0,y.jsx)(f.al,{onMax:function(){b(u.usdc.toString())},children:(0,y.jsx)(f.ts,{value:p,onChange:function(e){b(e);var t=parseFloat(e)||0;0===t?P(""):t<F&&P((0,d.fr)(g,0,a*t))},className:"w-full pr-14"})}),(0,y.jsxs)("div",{className:"mt-2 opacity-50",children:["Balance: ",Y(u.usdc)]})]}),(0,y.jsxs)("div",{className:"w-1/2",children:[(0,y.jsxs)("div",{className:"text-center text-3xl font-bold text-accent",children:[Math.round(100*(t.max+t.max*(B&&F?C():r)))/100,"%"]}),(0,y.jsxs)("div",{className:"flex justify-center",children:["Max APY in uCR",(0,y.jsx)(D,{content:"All the rewards are multiplied and provided in uCR"})]})]})]}),(0,y.jsx)(f.DK,{text:"Boosters"}),(0,y.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"w-5/12 bg-center bg-no-repeat",style:{backgroundImage:"url('data:image/svg+xml;utf8,".concat(f.ci.stringsCyan.ubq,"')")},children:[(0,y.jsx)("div",{className:"flex justify-between",children:(0,y.jsx)("span",{className:"font-bold",children:"UBQ"})}),(0,y.jsxs)("div",{className:"mb-2 w-10/12 text-left",children:[(0,y.jsx)("span",{children:"Minimizes deposit fee"}),(0,y.jsx)(D,{content:"The deposit fee gets converted to uCR when you withdraw"})]}),(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsx)(f.al,{onMax:function(){var e=n>u.ubq?u.ubq:n;v(e.toString())},className:"w-10/12",children:(0,y.jsx)(f.ts,{value:j,onChange:function(e){v((0,d.fr)(e,0,n))},placeholder:"".concat(n.toLocaleString()," for 0% fee"),className:"w-full pr-14"})}),(0,y.jsxs)("div",{className:"flex w-2/12 flex-col items-center justify-center text-center text-accent",children:[(0,y.jsxs)("span",{children:[Math.round(100*(c-k/n*(c-o))*100)/100,"%"]}),(0,y.jsx)("span",{className:"text-xs",children:"FEE"})]})]}),(0,y.jsxs)("div",{className:"mt-2 w-10/12 opacity-50",children:["Balance: ",Y(u.ubq)]})]}),(0,y.jsxs)("div",{className:"w-5/12 bg-center bg-no-repeat",style:{backgroundImage:"url('data:image/svg+xml;utf8,".concat(f.ci.stringsCyan.uad,"')")},children:[(0,y.jsx)("div",{className:"flex justify-between",children:(0,y.jsx)("span",{className:"font-bold",children:"uAD"})}),(0,y.jsxs)("div",{className:"mb-2  w-10/12 text-left",children:[(0,y.jsx)("span",{children:"Boosts yield"}),(0,y.jsx)(D,{content:"Match 50% of the USDC deposit and you get an extra 50% boost"})]}),(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsx)(f.al,{onMax:function(){var e=a*F;e>u.uad&&(e=u.uad),P(e.toString())},disabled:F<=0,className:"w-10/12",children:(0,y.jsx)(f.ts,{disabled:F<=0,value:g,onChange:function(e){P((0,d.fr)(e,0,a*F))},placeholder:"".concat(100*a,"% of deposit for max boost"),className:"w-full pr-14"})}),(0,y.jsxs)("div",{className:"flex flex-col items-center justify-center text-center text-accent",children:[(0,y.jsxs)("span",{children:[Math.round(100*C()*100)/100,"%"]}),(0,y.jsx)("span",{className:"text-xs",children:"BOOST"})]})]}),(0,y.jsxs)("div",{className:"mt-2 w-10/12 opacity-50",children:["Balance: ",Y(u.uad)]})]})]}),(0,y.jsxs)(y.Fragment,{children:[A.length?(0,y.jsx)("div",{children:A.map((function(e,t){return(0,y.jsx)("div",{className:"text-red-500",children:e},t)}))}):null,(0,y.jsx)("div",{className:"flex justify-center pt-8",children:(0,y.jsx)(f.zx,{styled:"accent",size:"lg",onClick:function(){p&&j&&g&&x({usdc:parseFloat(p),ubq:parseFloat(j),uad:parseFloat(g)})},disabled:!(F>0&&F<=u.usdc&&k>=0&&k<=u.ubq&&B>=0&&B<=u.uad)||l,children:"Deposit"})})]})]})})),B=(0,i.memo)((0,u.Z)((function(e){var t=e.managedContracts,n=e.namedContracts,r=e.walletAddress,u=e.signer,f=(0,i.useState)(null),m=f[0],p=f[1],b=(0,i.useState)(null),j=b[0],w=b[1],g=(0,x.ds)(),P=(0,s.Z)(g,3),N=P[1],Y=P[2],M=(0,x.ln)(),F=(0,s.Z)(M,2),k=F[0],B=F[1];function C(){return D.apply(this,arguments)}function D(){return(D=(0,a.Z)(c().mark((function e(){var t,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(n);case 2:return t=e.sent,e.next=5,v(t,n,r);case 5:a=e.sent,p(t),w(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,i.useEffect)((function(){(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C();case 1:case"end":return e.stop()}}),e)})))()}),[]);var q={onDeposit:function(){var e=(0,a.Z)(c().mark((function e(s){var r,i,x;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s.usdc,i=s.ubq,x=s.uad,N("Depositing...",(0,a.Z)(c().mark((function e(){var a,s,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.vz(String(r),6),s=o.vz(String(i),18),f=o.vz(String(x),18),console.log("Depositing: USDC ".concat(r," | UBQ ").concat(i," | uAD ").concat(x)),e.next=6,(0,l.A)("USDC",n.usdc,a,u,n.yieldProxy.address,6);case 6:if(e.t2=e.sent,!e.t2){e.next=11;break}return e.next=10,(0,l.A)("UBQ",t.ugov,s,u,n.yieldProxy.address);case 10:e.t2=e.sent;case 11:if(e.t1=e.t2,!e.t1){e.next=16;break}return e.next=15,(0,l.A)("uAD",t.uad,f,u,n.yieldProxy.address);case 15:e.t1=e.sent;case 16:if(e.t0=e.t1,!e.t0){e.next=21;break}return e.next=20,(0,d.$e)(n.yieldProxy.connect(u).deposit(a,f,s));case 20:e.t0=e.sent;case 21:if(!e.t0){e.next=28;break}return e.next=24,C();case 24:return e.next=26,B();case 26:e.next=28;break;case 28:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onWithdraw:function(){var e=(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N("Withdrawing...",(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.$e)(n.yieldProxy.connect(u).withdrawAll());case 2:return e.next=4,C();case 4:return e.next=6,B();case 6:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},O=k&&{usdc:+o.bM(k.usdc,6),ubq:+o.dF(k.ubq),uad:+o.dF(k.uad)};return(0,y.jsx)(A,{yieldProxyData:m,depositInfo:j,isProcessing:Y,actions:q,balance:O})}),(function(){return f.im})))},6117:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/yield-farming",function(){return n(8258)}])}},function(e){e.O(0,[774,888,179],(function(){return t=6117,e(e.s=t);var t}));var t=e.O();_N_E=t}]);