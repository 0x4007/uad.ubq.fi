(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{4571:function(e,t,n){"use strict";n.d(t,{i:function(){return s},d:function(){return a}});var r=n(7616),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e5;return(Math.round(+r.bM(e,"mwei")*t)/t).toString()},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e5;return(Math.round(+r.dF(e)*t)/t).toString()}},8118:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(2809),s=n(6311),a=n(5193),o=n(7098),c=n(1582),i=n(6484),u=n(5893);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e,t){return function(n){var d=(0,i.ZP)(),f=(0,s.Z)(d,1)[0],p=f.walletAddress,x=f.signer,h=f.provider,m=(0,o.ZP)(),b=(0,a.Z)(),g=(0,c.ZP)();return h&&p&&x&&m&&b&&g?(0,u.jsx)(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({web3Provider:h,walletAddress:p,signer:x,namedContracts:g,managedContracts:m,deployedContracts:b},n)):t?(0,u.jsx)(t,{}):null}}},6643:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var r=n(6311),s=n(9753),a=n(2809),o=n(266),c=n(809),i=n.n(c),u=n(2593),l=n(7616),d=n(7294),f=n(4571),p=n(2505),x=n(8118),h=n(4358),m=n(5893),b=function(e){return+e.toString()/1e18},g=function(e){return+e.toString()},v=208;function w(e){return j.apply(this,arguments)}function j(){return(j=(0,o.Z)(i().mark((function e(t){var n,r,s,a,o,c,u,l,d,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ugovUadPair.getReserves();case 2:return n=e.sent,r=+n.reserve0.toString()/+n.reserve1.toString(),e.next=6,t.masterChef.uGOVPerBlock();case 6:return s=e.sent,e.next=9,t.masterChef.uGOVmultiplier();case 9:return a=e.sent,o=b(s.mul(a).div("".concat(1e18))),e.t0=g,e.next=14,t.bonding.blockCountInAWeek();case 14:return e.t1=e.sent,c=(0,e.t0)(e.t1),u=o*c,e.t2=b,e.next=20,t.masterChef.totalShares();case 20:return e.t3=e.sent,l=(0,e.t2)(e.t3),d=u*r,e.next=25,t.bonding.bondingDiscountMultiplier();case 25:return f=e.sent,e.abrupt("return",{totalShares:l,usdPerWeek:d,bondingDiscountMultiplier:f});case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t,n){return O.apply(this,arguments)}function O(){return(O=(0,o.Z)(i().mark((function e(t,n,r){var s,a,o,c,d,f,p,x;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.totalShares,a=n.usdPerWeek,o=n.bondingDiscountMultiplier,c=365.2422,.7562534324,d=l.fi(.7562534324.toString()),f=u.O$.from(r.toString()),e.t0=b,e.next=8,t.ubiquityFormulas.durationMultiply(d,f,o);case 8:return e.t1=e.sent,p=(0,e.t0)(e.t1),x=p/s*a/7*c*100,e.abrupt("return",Math.round(100*x)/100);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=(0,x.Z)((function(e){var t=e.onStake,n=e.disabled,a=e.maxLp,c=e.managedContracts,f=(0,d.useState)(""),x=f[0],h=f[1],b=(0,d.useState)(""),g=b[0],j=b[1],O=(0,d.useState)(null),y=O[0],S=O[1],P=(0,d.useState)(null),C=P[0],N=P[1],Z=(0,d.useState)(null),A=Z[0],L=Z[1];var B=x&&l.fi(x).gt(a)?"You don't have enough uAD-3CRV tokens":null,D=!!B;(0,d.useEffect)((function(){(0,o.Z)(i().mark((function e(){var t,n,s,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(c);case 2:return t=e.sent,N(t),e.next=6,Promise.all([k(c,t,1),k(c,t,v)]);case 6:n=e.sent,s=(0,r.Z)(n,2),a=s[0],o=s[1],L([a,o]);case 11:case"end":return e.stop()}}),e)})))()}),[]),(0,d.useEffect)((function(){(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!C||!g){e.next=8;break}return e.t0=S,e.next=4,k(c,C,parseInt(g));case 4:e.t1=e.sent,(0,e.t0)(e.t1),e.next=9;break;case 8:S(null);case 9:case"end":return e.stop()}}),e)})))()}),[C,g]);var E=!x||!g,W=parseFloat(x);return(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:"mb-4 text-center text-3xl text-accent opacity-75",children:["APY ",y?"".concat(y,"%"):A?"".concat(A[0],"% - ").concat(A[1],"%"):"..."]}),(0,m.jsxs)("div",{className:"mb-4 grid grid-cols-4 justify-center gap-4",children:[(0,m.jsx)(s.ts,{value:x,onChange:function(e){h(e)},disabled:n,placeholder:"uAD-3CRV LP Tokens"}),(0,m.jsx)(s.ts,{value:g,fraction:!1,onChange:function(e){j(e&&(0,p.us)(parseInt(e),1,v).toString())},disabled:n,placeholder:"Weeks (".concat(1,"-").concat(v,")")}),(0,m.jsx)(s.zx,{disabled:n,onClick:function(){h(l.dF(a)),j(v.toString())},children:"MAX"}),(0,m.jsx)(s.zx,{styled:"accent",disabled:n||D||E||!W,onClick:function(){t({amount:l.fi(x),weeks:u.O$.from(g)})},children:"Stake LP Tokens"})]}),(0,m.jsx)("div",{className:"mb-2 text-center",children:B&&(0,m.jsx)("p",{children:B})})]})}));function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=.75,N=(0,d.memo)((function(e){var t=e.model,n=e.actions;return(0,m.jsxs)(s.W2,{className:"relative !mx-auto max-w-screen-md",children:[(0,m.jsx)(s.Dx,{text:"Stake uAD-3CRV tokens -> Receive uBQ"}),t?(0,m.jsx)(Z,P(P({},t),n)):(0,m.jsx)(s.gb,{text:"Loading existing shares information"})]})})),Z=function(e){var t=e.shares,n=e.totalShares,r=e.onWithdrawLp,a=e.onClaimUbq,o=e.onStake,c=e.processing,i=e.walletLpBalance,d=t.reduce((function(e,t){return e.add(t.sharesBalance)}),u.O$.from(0)),p=t.reduce((function(e,t){return e.add(t.bond.lpAmount)}),u.O$.from(0)),x=t.reduce((function(e,t){return e.add(t.ugov)}),u.O$.from(0)),h=(0,f.d)(d.mul(l.fi("100")).div(n)),b=t.filter((function(e){var t=e.bond.lpAmount,n=e.ugov;return t.gt(0)||n.gt(0)}));return(0,m.jsxs)("div",{className:"relative flex flex-col",children:[(0,m.jsx)(y,{onStake:o,disabled:c,maxLp:i}),(0,m.jsx)("div",{className:"mb-6 rounded-lg border border-solid border-accent/60",children:(0,m.jsxs)("table",{className:"m-0 w-full text-center",children:[(0,m.jsx)("thead",{className:"border-b border-solid border-accent/60",children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"border-r border-solid border-white/10 p-2 !text-xs",children:"Deposit (Approx.)"}),(0,m.jsx)("th",{className:"border-r border-solid border-white/10 p-2 !text-xs",children:"Pending Reward"}),(0,m.jsx)("th",{className:"border-r border-solid border-white/10 p-2 !text-xs",children:"Unlock Time"}),(0,m.jsx)("th",{className:"border-r border-solid border-white/10 p-2 !text-xs",children:"Action"})]})}),b.length>0?(0,m.jsx)("tbody",{children:b.map((function(e){return(0,m.jsx)(A,P(P({},e),{},{onWithdrawLp:r,onClaimUbq:a}),e.id)}))}):(0,m.jsx)("tbody",{children:(0,m.jsx)("tr",{children:(0,m.jsx)("td",{className:"py-4",colSpan:5,children:"Nothing staked yet"})})})]})}),(0,m.jsxs)("div",{id:"rewards-summary flex flex-col items-center justify-center",children:[(0,m.jsxs)("div",{className:"mb-2 flex items-center justify-center",children:[(0,m.jsx)(s.JO,{className:"mr-2 w-4 text-accent",icon:"ubq"}),(0,m.jsxs)("span",{className:"text-accent",children:[(0,f.d)(x)," "]}),"\xa0pending UBQ rewards"]}),(0,m.jsxs)("div",{className:"mb-2 flex items-center justify-center",children:[(0,m.jsx)(s.JO,{className:"mr-2 w-4 text-accent",icon:"liquidity"}),(0,f.d)(p)," LP locked in Bonding Shares"]}),(0,m.jsxs)("div",{className:"mb-2 text-center",children:[h,"% pool ownership"]})]})]})},A=function(e){var t=e.id,n=e.ugov,r=e.sharesBalance,a=e.bond,o=e.weeksLeft,c=e.onWithdrawLp,i=e.onClaimUbq,u=(0,d.useState)("")[0],l=+(0,f.d)(a.lpAmount),p=1.3333333333333333*l;return(0,m.jsxs)("tr",{className:"h-12",title:t.toString(),children:[(0,m.jsxs)("td",{className:"border-r border-solid border-white/10 text-white",title:"LP = ".concat(l," | Shares = ").concat((0,f.d)(r)," | 1 USD = ").concat(C," LP"),children:["$",Math.round(100*p)/100]}),(0,m.jsx)("td",{className:"border-r border-solid border-white/10",children:(0,m.jsxs)("div",{className:"inline-flex items-center whitespace-nowrap text-accent",children:[(0,m.jsx)(s.JO,{icon:"ubq",className:"mr-2 w-4 text-accent"})," ",(0,m.jsx)("span",{children:(0,f.d)(n)})]})}),(0,m.jsx)("td",{className:"border-r border-solid border-white/10",children:o<=0?"Ready":(0,m.jsxs)("span",{children:[o,"w"]})}),(0,m.jsx)("td",{className:"px-1",children:o<=0&&a.lpAmount.gt(0)?(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("button",{onClick:function(){var e=parseFloat(u);c(e?{id:t,amount:e*C}:{id:t,amount:null})},children:"Claim & Withdraw"})}):n.gt(0)?(0,m.jsx)(s.zx,{onClick:function(){return i(+t.toString())},children:"Claim reward"}):null})]},t)},L=(0,x.Z)((function(e){var t=e.managedContracts,n=e.web3Provider,s=e.walletAddress,a=e.signer,c=(0,d.useState)(null),f=c[0],x=c[1],b=(0,h.ds)(),g=(0,r.Z)(b,2)[1],v=(0,h.ln)(),w=(0,r.Z)(v,2)[1],j=t.bonding,k=t.masterChef,O=t.bondingToken,y=t.metaPool;function S(){return C.apply(this,arguments)}function C(){return(C=(0,o.Z)(i().mark((function e(){var t,a,c,u,l,d,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.time("BondingShareExplorerContainer contract loading"),e.next=3,n.getBlockNumber();case 3:return t=e.sent,e.next=6,j.blockCountInAWeek();case 6:return a=+e.sent.toString(),e.next=9,k.totalShares();case 9:return c=e.sent,e.next=12,O.holderTokens(s);case 12:return u=e.sent,e.next=15,y.balanceOf(s);case 15:return l=e.sent,d=[],e.next=19,Promise.all(u.map(function(){var e=(0,o.Z)(i().mark((function e(n){var o,c,u,l,f,p,x,h,m;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([k.pendingUGOV(n),O.getBond(n),k.getBondingShareInfo(n),O.balanceOf(s,n)]);case 2:o=e.sent,c=(0,r.Z)(o,4),u=c[0],l=c[1],f=c[2],p=c[3],x=+l.endBlock.toString(),h=x-t,m=Math.round(h/a*100)/100,+p.toString()>0&&d.push({id:+n.toString(),ugov:u,bond:l,sharesBalance:f[0],weeksLeft:m});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 19:f=d.sort((function(e,t){return e.id-t.id})),console.timeEnd("BondingShareExplorerContainer contract loading"),x({processing:!1,shares:f,totalShares:c,walletLpBalance:l});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){var t,n;if(!f)throw new Error("No model");var r=null===(t=f.shares.find((function(t){return t.id===e})))||void 0===t||null===(n=t.bond)||void 0===n?void 0:n.lpAmount;if(!r)throw new Error("Could not find share in model");return r}(0,p.zN)(S);var A={onWithdrawLp:(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.id,r=t.amount,f&&!f.processing){e.next=3;break}return e.abrupt("return");case 3:console.log("Withdrawing ".concat(r||"ALL"," LP from ").concat(n)),x(P(P({},f),{},{processing:!0})),g("Withdrawing LP...",(0,o.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.isApprovedForAll(s,j.address);case 2:if(e.sent){e.next=8;break}return e.next=6,(0,p.$e)(O.connect(a).setApprovalForAll(j.address,!0));case 6:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:return t=r?l.fi(r.toString()):Z(n),e.next=11,(0,p.$e)(j.connect(a).removeLiquidity(t,u.O$.from(n)));case 11:S(),w();case 13:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f]),onClaimUbq:(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f&&!f.processing){e.next=2;break}return e.abrupt("return");case 2:console.log("Claiming UBQ rewards from ".concat(t)),x(P(P({},f),{},{processing:!0})),g("Claiming UBQ...",(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.$e)(k.connect(a).getRewards(u.O$.from(t)));case 2:S(),w();case 4:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f]),onStake:(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(t){var n,r,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.amount,r=t.weeks,f&&!f.processing){e.next=3;break}return e.abrupt("return");case 3:return console.log("Staking ".concat(n," for ").concat(r," weeks")),x(P(P({},f),{},{processing:!0})),g("Staking...",(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))),e.next=8,y.allowance(s,j.address);case 8:if(c=e.sent,console.log("allowance",l.dF(c)),console.log("lpsAmount",l.dF(n)),!c.lt(n)){e.next=18;break}return e.next=14,(0,p.$e)(y.connect(a).approve(j.address,n));case 14:return e.next=16,y.allowance(s,j.address);case 16:u=e.sent,console.log("allowance2",l.dF(u));case 18:return e.next=20,(0,p.$e)(j.connect(a).deposit(n,r));case 20:S(),w();case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f])};return(0,m.jsx)(N,{model:f,actions:A})})),B=function(){var e=(0,h.GJ)();return(0,r.Z)(e,1)[0]?(0,m.jsx)(L,{}):s.im}},5081:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/staking",function(){return n(6643)}])}},function(e){e.O(0,[774,888,179],(function(){return t=5081,e(e.s=t);var t}));var t=e.O();_N_E=t}]);